# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é n8n Workflow

**–î–∞—Ç–∞**: 22 —è–Ω–≤–∞—Ä—è 2025
**–°–µ—Ä–≤–µ—Ä**: https://cuhelibbeerank.beget.app/

---

## –®–∞–≥ 1: –í—Ö–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä n8n

1. –û—Ç–∫—Ä—ã—Ç—å: https://cuhelibbeerank.beget.app/
2. –í–≤–µ—Å—Ç–∏ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å (–¥–∞–Ω–Ω—ã–µ —É –≤–∞—Å –µ—Å—Ç—å)

---

## –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Credentials

### 2.1 Supabase API Credential

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é ‚Üí **Credentials**
2. –ù–∞–∂–∞—Ç—å **+ Add credential**
3. –ù–∞–π—Ç–∏ –∏ –≤—ã–±—Ä–∞—Ç—å **Supabase**
4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å:
   - **Name**: `Travel Bot Supabase`
   - **Host**: `https://ivrcaknzkasscojdjozz.supabase.co`
   - **Service Role Secret**: (–í–∑—è—Ç—å –∏–∑ Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí service_role key)

5. –ù–∞–∂–∞—Ç—å **Save**

### 2.2 OpenAI API Credential

1. Credentials ‚Üí **+ Add credential**
2. –ù–∞–π—Ç–∏ –∏ –≤—ã–±—Ä–∞—Ç—å **OpenAI**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å:
   - **Name**: `Travel Bot OpenAI`
   - **API Key**:
   ```
   YOUR_OPENAI_API_KEY_HERE
   ```
4. –ù–∞–∂–∞—Ç—å **Save**

### 2.3 Telegram Bot API Credential

1. Credentials ‚Üí **+ Add credential**
2. –ù–∞–π—Ç–∏ –∏ –≤—ã–±—Ä–∞—Ç—å **Telegram**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å:
   - **Name**: `Travel Bot Telegram`
   - **Access Token**: `8205281658:AAFPl2Ise5TaUFLqjiVj_Chnd_G5-Davz2o`

4. –ù–∞–∂–∞—Ç—å **Save**

---

## –®–∞–≥ 3: –ò–º–ø–æ—Ä—Ç Workflow

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ UI (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –í –≤–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é ‚Üí **Workflows**
2. –ù–∞–∂–∞—Ç—å **+ Add workflow**
3. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É ‚Üí –º–µ–Ω—é (—Ç—Ä–∏ —Ç–æ—á–∫–∏) ‚Üí **Import from File**
4. –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª: `unified-travel-bot-workflow.json`
5. –ù–∞–∂–∞—Ç—å **Import**

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ JSON (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

1. Workflows ‚Üí **+ Add workflow**
2. –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª ‚Üí –º–µ–Ω—é ‚Üí **Import from URL or Text**
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `unified-travel-bot-workflow.json`
4. –í—Å—Ç–∞–≤–∏—Ç—å –≤ –ø–æ–ª–µ
5. –ù–∞–∂–∞—Ç—å **Import**

---

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Workflow Nodes

–ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ –Ω—É–∂–Ω–æ **–ø—Ä–∏–≤—è–∑–∞—Ç—å credentials –∫ —É–∑–ª–∞–º**:

### 4.1 Supabase Nodes
–£–∑–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:
- `Save User Request`
- `Get All Cities`
- `Save/Update Events`
- `Get 24h Subscriptions`
- `Get 30min Subscriptions`
- `Mark 24h Sent`
- `Mark 30min Sent`
- `Update Request Status`

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞**:
1. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —É–∑–µ–ª
2. –í –ø–æ–ª–µ **Credential** –≤—ã–±—Ä–∞—Ç—å `Travel Bot Supabase`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### 4.2 OpenAI Nodes
–£–∑–ª—ã:
- `OpenAI - City Summary`
- `OpenAI - Attractions`
- `OpenAI - Hotels`

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞**:
1. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —É–∑–µ–ª
2. –í –ø–æ–ª–µ **Credential** –≤—ã–±—Ä–∞—Ç—å `Travel Bot OpenAI`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### 4.3 Telegram Nodes
–£–∑–ª—ã:
- `Send 24h Notification`
- `Send 30min Notification`

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞**:
1. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —É–∑–µ–ª
2. –í –ø–æ–ª–µ **Credential** –≤—ã–±—Ä–∞—Ç—å `Travel Bot Telegram`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

---

## –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook URL

1. –ù–∞–π—Ç–∏ —É–∑–µ–ª **Webhook - City Search**
2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –Ω–µ–≥–æ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **HTTP Method**: POST
   - **Path**: `city-search`
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å **Production URL** (–±—É–¥–µ—Ç —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ `https://cuhelibbeerank.beget.app/webhook/city-search`)
5. –≠—Ç–æ—Ç URL —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞–Ω –≤ `.env` —Ñ–∞–π–ª–µ –±–æ—Ç–∞

---

## –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cron –¢—Ä–∏–≥–≥–µ—Ä–æ–≤

### 6.1 Daily Event Update (–∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞)
1. –ù–∞–π—Ç–∏ —É–∑–µ–ª **Cron - Daily Event Update**
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - **Mode**: Every 24 hours
   - **Hour**: 2 (2:00 –Ω–æ—á–∏)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### 6.2 24h Notifications (–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)
1. –ù–∞–π—Ç–∏ —É–∑–µ–ª **Cron - 24h Notifications**
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - **Mode**: Every 6 hours
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### 6.3 30min Notifications (–∫–∞–∂–¥—ã–π —á–∞—Å)
1. –ù–∞–π—Ç–∏ —É–∑–µ–ª **Cron - 30min Notifications**
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - **Mode**: Every hour
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

---

## –®–∞–≥ 7: –ê–∫—Ç–∏–≤–∞—Ü–∏—è Workflow

1. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å **Inactive**
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤ –ø–æ–ª–æ–∂–µ–Ω–∏–µ **Active**
3. Workflow –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!

---

## –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç Webhook
```bash
curl -X POST https://cuhelibbeerank.beget.app/webhook/city-search \
  -H "Content-Type: application/json" \
  -d '{
    "telegram_id": 123456789,
    "username": "test",
    "first_name": "Test",
    "city": "–ú–æ—Å–∫–≤–∞",
    "date_from": "2025-01-25T00:00:00Z",
    "date_to": "2025-01-27T00:00:00Z"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –≥–æ—Ä–æ–¥–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ n8n
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Executions** (–≤ workflow)
2. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
3. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∑–∞–ø–∏—Å—å ‚Üí –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Credential not found"
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å credential –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∞ OpenAI
**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –Ω–∞ https://platform.openai.com/account/billing
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ Supabase
**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **service_role key**, –∞ –Ω–µ anon key
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç (–≤—ã–ø–æ–ª–Ω–∏—Ç—å supabase_schema.sql)

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Webhook –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ workflow –∞–∫—Ç–∏–≤–µ–Ω (Active)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL webhook –≤ –ª–æ–≥–∞—Ö n8n
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—É—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `/webhook/city-search`

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
1. –û—Ç–∫—Ä—ã—Ç—å workflow
2. –í–∫–ª–∞–¥–∫–∞ **Executions**
3. –í—ã–±—Ä–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ workflow:
1. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —É–∑–µ–ª **Webhook - City Search**
2. –ù–∞–∂–∞—Ç—å **Listen for Test Event**
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ curl
4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ:
- ‚úÖ Workflow –∞–∫—Ç–∏–≤–µ–Ω (Active)
- ‚úÖ Executions —É—Å–ø–µ—à–Ω—ã (–Ω–µ—Ç –æ—à–∏–±–æ–∫)
- ‚úÖ OpenAI API key –≤–∞–ª–∏–¥–µ–Ω
- ‚úÖ Supabase –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ Telegram –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:
n8n –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ –≤ Executions. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏—Ö —Ä–µ–≥—É–ª—è—Ä–Ω–æ.

---

## –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. ‚úÖ Workflow —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç
2. ‚úÖ Credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
3. ‚úÖ Workflow –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
4. ‚è≥ –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –≤ Supabase (—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã user_requests, event_subscriptions)
5. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –±–æ—Ç–∞

---

**Workflow –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!** üöÄ
