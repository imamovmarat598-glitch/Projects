# üí≥ –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –°–ë–ü –¥–ª—è City Travel Bot

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è **–°–∏—Å—Ç–µ–º—ã –ë—ã—Å—Ç—Ä—ã—Ö –ü–ª–∞—Ç–µ–∂–µ–π (–°–ë–ü)** –¥–ª—è –ø—Ä–∏–µ–º–∞ –æ–ø–ª–∞—Ç—ã –ø–æ–¥–ø–∏—Å–æ–∫ Premium –∏ VIP –Ω–∞–ø—Ä—è–º—É—é –≤ Telegram –±–æ—Ç–µ.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –°–ë–ü:
- ‚úÖ **–ë–µ–∑ –∫–æ–º–∏—Å—Å–∏–π** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–ù–∏–∑–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è** –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ (~0.4-0.7%)
- ‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥** (1-2 —Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ **QR-–∫–æ–¥** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ–ø–ª–∞—Ç—ã
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º –±–∞–Ω–∫–æ–º** –†–§
- ‚úÖ **–ù–µ –Ω—É–∂–Ω–∞ –∫–∞—Ä—Ç–∞** - –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –±–∞–Ω–∫–æ–≤—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## üè¶ –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –°–ë–ü

### 1. –ÆMoney (–Ø–Ω–¥–µ–∫—Å.–î–µ–Ω—å–≥–∏)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Telegram Payments –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ö–æ–º–∏—Å—Å–∏—è: 2-3% (–±–µ–∑ –°–ë–ü), 0.5% (–°–ë–ü)
- –ë—ã—Å—Ç—Ä—ã–π –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [yoomoney.ru](https://yoomoney.ru/transfer/myservices)
2. –°–æ–∑–¥–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω
3. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
4. –í–∫–ª—é—á–∏—Ç–µ –°–ë–ü –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://yoomoney.ru/docs/payment-buttons/using-api

---

### 2. CloudPayments

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°–ë–ü –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Ä–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
- –ö–æ–º–∏—Å—Å–∏—è: 2.8% (–∫–∞—Ä—Ç—ã), 0.4-0.7% (–°–ë–ü)
- –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ [cloudpayments.ru](https://cloudpayments.ru/)
2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –°–ë–ü
3. API –∫–ª—é—á

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://developers.cloudpayments.ru/

---

### 3. –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ö–∞—Å—Å–∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –±–∞–Ω–∫–∞
- –°–ë–ü –≤—Å—Ç—Ä–æ–µ–Ω
- –ö–æ–º–∏—Å—Å–∏—è: –æ—Ç 2.49%
- –í—ã–≤–æ–¥ –Ω–∞ —Å—á–µ—Ç –≤ –¢–∏–Ω—å–∫–æ—Ñ—Ñ

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç –≤ –¢–∏–Ω—å–∫–æ—Ñ—Ñ
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ö–∞—Å—Å—É
3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –°–ë–ü

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://www.tinkoff.ru/kassa/develop/

---

### 4. –°–±–µ—Ä–±–∞–Ω–∫ –≠–∫–≤–∞–π—Ä–∏–Ω–≥

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ö—Ä—É–ø–Ω–µ–π—à–∏–π –±–∞–Ω–∫
- –°–ë–ü –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ö–æ–º–∏—Å—Å–∏—è: –æ—Ç 1.8%

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä–∞

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ÆMoney

**–ü–æ—á–µ–º—É:**
- ‚úÖ –°–∞–º–∞—è –ø—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ —Å—á–µ—Ç–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ Telegram Payment Provider
- ‚úÖ –ù–∏–∑–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–∞ –°–ë–ü (0.5%)
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø–∞

---

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: Telegram Payments API (—Å –ÆMoney)

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:

1. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –æ—Ç –ÆMoney**
2. **–î–æ–±–∞–≤—å—Ç–µ –≤ .env:**
```env
PAYMENT_PROVIDER_TOKEN=your_yoomoney_provider_token
YOOMONEY_SHOP_ID=your_shop_id
YOOMONEY_SECRET_KEY=your_secret_key
```

#### –ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

```typescript
// src/services/payment.service.ts

import { Telegraf } from 'telegraf';

class PaymentService {
  private bot: Telegraf;

  constructor(bot: Telegraf) {
    this.bot = bot;
  }

  /**
   * –°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç –¥–ª—è –æ–ø–ª–∞—Ç—ã
   */
  async createInvoice(
    ctx: any,
    subscriptionType: 'premium' | 'vip',
    duration: 1 | 3 | 12 // –º–µ—Å—è—Ü–µ–≤
  ) {
    const prices = {
      premium: { 1: 299, 3: 799, 12: 2999 },
      vip: { 1: 999, 3: 2799, 12: 9999 },
    };

    const price = prices[subscriptionType][duration];
    const title = subscriptionType === 'premium' ? 'Premium –ø–æ–¥–ø–∏—Å–∫–∞' : 'VIP –ø–æ–¥–ø–∏—Å–∫–∞';
    const description = `${title} –Ω–∞ ${duration} ${this.getMonthWord(duration)}`;

    await ctx.replyWithInvoice({
      title,
      description,
      payload: `${subscriptionType}_${duration}_${Date.now()}`,
      provider_token: process.env.PAYMENT_PROVIDER_TOKEN!,
      currency: 'RUB',
      prices: [
        {
          label: description,
          amount: price * 100, // –≤ –∫–æ–ø–µ–π–∫–∞—Ö
        },
      ],
      photo_url: 'https://your-cdn.com/subscription-image.jpg',
      photo_width: 640,
      photo_height: 360,
      need_name: false,
      need_phone_number: false,
      need_email: false,
      need_shipping_address: false,
      is_flexible: false,
    });
  }

  /**
   * –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
   */
  async handleSuccessfulPayment(ctx: any) {
    const payment = ctx.message.successful_payment;
    const payload = payment.invoice_payload; // "premium_1_1234567890"

    const [type, duration] = payload.split('_');
    const userId = ctx.from.id;

    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫—É
    const expiresAt = new Date();
    expiresAt.setMonth(expiresAt.getMonth() + parseInt(duration));

    await googleSheetsService.updateSubscription(userId, type, expiresAt);

    // –õ–æ–≥–∏—Ä—É–µ–º –ø–ª–∞—Ç–µ–∂
    await this.logPayment({
      user_id: userId,
      subscription_type: type,
      duration: parseInt(duration),
      amount: payment.total_amount / 100,
      currency: payment.currency,
      provider_payment_id: payment.provider_payment_charge_id,
      paid_at: new Date(),
    });

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    await ctx.reply(
      `üéâ –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É!\n\n` +
      `‚úÖ ${type.toUpperCase()} –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞\n` +
      `üìÖ –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: ${expiresAt.toLocaleDateString()}\n\n` +
      `–¢–µ–ø–µ—Ä—å –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã:\n` +
      this.getFeaturesList(type)
    );
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã (pre-checkout)
   */
  async handlePreCheckout(ctx: any) {
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏
    // –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–∞–Ω–µ–Ω

    await ctx.answerPreCheckoutQuery(true);
  }

  private getMonthWord(count: number): string {
    if (count === 1) return '–º–µ—Å—è—Ü';
    if (count < 5) return '–º–µ—Å—è—Ü–∞';
    return '–º–µ—Å—è—Ü–µ–≤';
  }

  private getFeaturesList(type: string): string {
    if (type === 'premium') {
      return (
        `‚Ä¢ –í—Å–µ –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Å–∏–∏ (100+)\n` +
        `‚Ä¢ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã\n` +
        `‚Ä¢ –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ—Ç–µ–ª–µ–π\n` +
        `‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã\n` +
        `‚Ä¢ –≠–∫—Å–ø–æ—Ä—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤`
      );
    } else {
      return (
        `‚Ä¢ –í—Å—ë –∏–∑ Premium +\n` +
        `‚Ä¢ AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç GPT-4\n` +
        `‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 30 –º–∏–Ω –¥–æ —Å–æ–±—ã—Ç–∏–π\n` +
        `‚Ä¢ –°–∫–∏–¥–∫–∏ –Ω–∞ –±–∏–ª–µ—Ç—ã –¥–æ 20%\n` +
        `‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞`
      );
    }
  }

  private async logPayment(data: any) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Google Sheets –ª–∏—Å—Ç "Payments"
    await googleSheetsService.appendRow('Payments', [
      data.user_id,
      data.subscription_type,
      data.duration,
      data.amount,
      data.currency,
      data.provider_payment_id,
      data.paid_at.toISOString(),
    ]);
  }
}
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –°–ë–ü (—á–µ—Ä–µ–∑ API –±–∞–Ω–∫–∞)

#### –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```typescript
// src/services/sbp.service.ts

import axios from 'axios';
import crypto from 'crypto';

class SBPService {
  private apiUrl: string;
  private merchantId: string;
  private secretKey: string;

  constructor() {
    this.apiUrl = process.env.SBP_API_URL || 'https://api.cloudpayments.ru';
    this.merchantId = process.env.SBP_MERCHANT_ID!;
    this.secretKey = process.env.SBP_SECRET_KEY!;
  }

  /**
   * –°–æ–∑–¥–∞—Ç—å QR-–∫–æ–¥ –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –°–ë–ü
   */
  async createSBPPayment(params: {
    amount: number;
    orderId: string;
    description: string;
  }): Promise<{ qrUrl: string; paymentId: string }> {
    const data = {
      Amount: params.amount,
      Currency: 'RUB',
      InvoiceId: params.orderId,
      Description: params.description,
      AccountId: params.orderId,
    };

    const response = await axios.post(
      `${this.apiUrl}/payments/qr/sbp/create`,
      data,
      {
        auth: {
          username: this.merchantId,
          password: this.secretKey,
        },
        headers: {
          'Content-Type': 'application/json',
        },
      }
    );

    if (response.data.Success) {
      return {
        qrUrl: response.data.Model.QrUrl, // –ö–∞—Ä—Ç–∏–Ω–∫–∞ QR-–∫–æ–¥–∞
        paymentId: response.data.Model.TransactionId,
      };
    }

    throw new Error('Failed to create SBP payment');
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
   */
  async checkPaymentStatus(paymentId: string): Promise<string> {
    const response = await axios.post(
      `${this.apiUrl}/payments/find`,
      { TransactionId: paymentId },
      {
        auth: {
          username: this.merchantId,
          password: this.secretKey,
        },
      }
    );

    return response.data.Model.Status; // Completed, Pending, Failed
  }

  /**
   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é QR-–∫–æ–¥
   */
  async sendQRCode(ctx: any, subscriptionType: 'premium' | 'vip', duration: number) {
    const prices = {
      premium: { 1: 299, 3: 799, 12: 2999 },
      vip: { 1: 999, 3: 2799, 12: 9999 },
    };

    const amount = prices[subscriptionType][duration];
    const orderId = `${ctx.from.id}_${subscriptionType}_${duration}_${Date.now()}`;
    const description = `${subscriptionType.toUpperCase()} –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ ${duration} –º–µ—Å.`;

    // –°–æ–∑–¥–∞–µ–º –ø–ª–∞—Ç–µ–∂
    const payment = await this.createSBPPayment({
      amount,
      orderId,
      description,
    });

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º QR-–∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await ctx.replyWithPhoto(
      { url: payment.qrUrl },
      {
        caption:
          `üí≥ –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –°–ë–ü\n\n` +
          `üí∞ –°—É–º–º–∞: ${amount}‚ÇΩ\n` +
          `üì± –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥\n` +
          `   –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–∞—à–µ–≥–æ –±–∞–Ω–∫–∞\n\n` +
          `‚è± QR-–∫–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 15 –º–∏–Ω—É—Ç\n\n` +
          `–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏`,
        reply_markup: {
          inline_keyboard: [
            [
              {
                text: '‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª',
                callback_data: `check_payment_${payment.paymentId}`,
              },
            ],
            [{ text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å', callback_data: 'cancel_payment' }],
          ],
        },
      }
    );

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    this.startPaymentCheck(ctx, payment.paymentId, orderId);
  }

  /**
   * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã
   */
  private async startPaymentCheck(ctx: any, paymentId: string, orderId: string) {
    const maxAttempts = 180; // 15 –º–∏–Ω—É—Ç (180 * 5 —Å–µ–∫)
    let attempts = 0;

    const checkInterval = setInterval(async () => {
      attempts++;

      try {
        const status = await this.checkPaymentStatus(paymentId);

        if (status === 'Completed') {
          clearInterval(checkInterval);

          // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫—É
          const [userId, type, duration] = orderId.split('_');
          const expiresAt = new Date();
          expiresAt.setMonth(expiresAt.getMonth() + parseInt(duration));

          await googleSheetsService.updateSubscription(
            parseInt(userId),
            type as any,
            expiresAt
          );

          await ctx.reply(
            `üéâ –û–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞!\n\n` +
            `‚úÖ ${type.toUpperCase()} –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞\n` +
            `üìÖ –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: ${expiresAt.toLocaleDateString()}`
          );
        } else if (status === 'Failed') {
          clearInterval(checkInterval);
          await ctx.reply('‚ùå –û–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
        }

        if (attempts >= maxAttempts) {
          clearInterval(checkInterval);
          await ctx.reply('‚è± –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø–ª–∞—Ç—ã –∏—Å—Ç–µ–∫–ª–æ.');
        }
      } catch (error) {
        console.error('Payment check error:', error);
      }
    }, 5000); // –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
  }
}

export const sbpService = new SBPService();
```

---

## üé® UI/UX –¥–ª—è –æ–ø–ª–∞—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ß–µ—Ä–µ–∑ Telegram Payments

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /premium
   ‚Üì
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ
   [Premium 299‚ÇΩ/–º–µ—Å]
   [Premium 799‚ÇΩ/3 –º–µ—Å] (-11%)
   [Premium 2999‚ÇΩ/–≥–æ–¥] (-16%)
   ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
   ‚Üì
Telegram –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ñ–æ—Ä–º—É –æ–ø–ª–∞—Ç—ã
   [–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –°–ë–ü]
   [–û–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π]
   ‚Üì
–í—ã–±–æ—Ä –°–ë–ü ‚Üí QR-–∫–æ–¥
   ‚Üì
–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±–∞–Ω–∫–æ–≤—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
   ‚Üì
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
   ‚Üì
‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /premium
   ‚Üì
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
   [üí≥ –°–ë–ü (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º - –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏)]
   [üí∞ –ÆMoney]
   [üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞]
   ‚Üì
–í—ã–±–æ—Ä –°–ë–ü
   ‚Üì
–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç QR-–∫–æ–¥
   ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –≤ –±–∞–Ω–∫–µ
   ‚Üì
–û–ø–ª–∞—Ç–∞ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
   ‚Üì
‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
```

---

## üí∞ –¢–∞—Ä–∏—Ñ—ã –∏ —Å–∫–∏–¥–∫–∏

### Premium –ø–æ–¥–ø–∏—Å–∫–∞:

| –ü–µ—Ä–∏–æ–¥ | –¶–µ–Ω–∞ | –¶–µ–Ω–∞/–º–µ—Å—è—Ü | –°–∫–∏–¥–∫–∞ |
|--------|------|------------|--------|
| 1 –º–µ—Å—è—Ü | 299‚ÇΩ | 299‚ÇΩ | - |
| 3 –º–µ—Å—è—Ü–∞ | 799‚ÇΩ | 266‚ÇΩ | -11% |
| 12 –º–µ—Å—è—Ü–µ–≤ | 2999‚ÇΩ | 250‚ÇΩ | -16% |

### VIP –ø–æ–¥–ø–∏—Å–∫–∞:

| –ü–µ—Ä–∏–æ–¥ | –¶–µ–Ω–∞ | –¶–µ–Ω–∞/–º–µ—Å—è—Ü | –°–∫–∏–¥–∫–∞ |
|--------|------|------------|--------|
| 1 –º–µ—Å—è—Ü | 999‚ÇΩ | 999‚ÇΩ | - |
| 3 –º–µ—Å—è—Ü–∞ | 2799‚ÇΩ | 933‚ÇΩ | -7% |
| 12 –º–µ—Å—è—Ü–µ–≤ | 9999‚ÇΩ | 833‚ÇΩ | -17% |

---

## üìä Google Sheets: –õ–∏—Å—Ç "Payments"

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π:

```
A: payment_id
B: user_id
C: subscription_type (premium/vip)
D: duration (1/3/12)
E: amount
F: currency (RUB)
G: payment_method (sbp/card/yoomoney)
H: status (pending/completed/failed)
I: provider_payment_id
J: created_at
K: completed_at
L: expires_at
```

---

## üîî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ó–∞ 7 –¥–Ω–µ–π –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è:

```
‚è∞ –í–∞—à–∞ Premium –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π

üìÖ –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: 20 —è–Ω–≤–∞—Ä—è 2026

–ü—Ä–æ–¥–ª–∏—Ç–µ —Å–µ–π—á–∞—Å —Å–æ —Å–∫–∏–¥–∫–æ–π 10%:
[–ü—Ä–æ–¥–ª–∏—Ç—å –∑–∞ 269‚ÇΩ] (–≤–º–µ—Å—Ç–æ 299‚ÇΩ)
```

### –ó–∞ 1 –¥–µ–Ω—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è:

```
‚ö†Ô∏è –ó–∞–≤—Ç—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ Premium

–ü—Ä–æ–¥–ª–∏—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:
[üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –°–ë–ü]
[üí∞ –î—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã]
```

### –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è:

```
üòî –í–∞—à–∞ Premium –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞

–í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ Free —Ç–∞—Ä–∏—Ñ:
‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 3 –≥–æ—Ä–æ–¥–∞
‚ùå 3 –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥–µ–Ω—å

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–æ—Å—Ç—É–ø:
[–û—Ñ–æ—Ä–º–∏—Ç—å Premium]
[–£–∑–Ω–∞—Ç—å –æ VIP]
```

---

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (1 –¥–µ–Ω—å)
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –ÆMoney
2. –°–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω
3. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
4. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –°–ë–ü

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (2-3 –¥–Ω—è)
1. –î–æ–±–∞–≤–∏—Ç—å payment.service.ts
2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤
3. –õ–∏—Å—Ç Payments –≤ Google Sheets
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã

### –≠—Ç–∞–ø 3: UI (1 –¥–µ–Ω—å)
1. –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ –ø–æ–¥–ø–∏—Å–∫–∏
2. –ö–Ω–æ–ø–∫–∏ –æ–ø–ª–∞—Ç—ã
3. –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### –≠—Ç–∞–ø 4: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (1 –¥–µ–Ω—å)
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
3. –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û–±—â–µ–µ –≤—Ä–µ–º—è: 5-6 –¥–Ω–µ–π**

---

## üìà –ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥–æ–≤ —Å –°–ë–ü

### –ö–æ–Ω–≤–µ—Ä—Å–∏—è Free ‚Üí Premium:

| –ú–µ—Å—è—Ü | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | –ö–æ–Ω–≤–µ—Ä—Å–∏—è | –ü–ª–∞—Ç—è—â–∏—Ö | –î–æ—Ö–æ–¥ |
|-------|--------------|-----------|----------|-------|
| 1 | 1,000 | 5% | 50 | 14,950‚ÇΩ |
| 3 | 5,000 | 6% | 300 | 89,700‚ÇΩ |
| 6 | 10,000 | 8% | 800 | 239,200‚ÇΩ |
| 12 | 20,000 | 10% | 2,000 | 598,000‚ÇΩ |

**–°–ë–ü —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏—é –Ω–∞ 15-20%** –∑–∞ —Å—á–µ—Ç:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–æ–º–∏—Å—Å–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∏–≤—ã—á–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
- –ë—ã—Å—Ç—Ä–æ—Ç–∞ (1-2 —Å–µ–∫—É–Ω–¥—ã)

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –ÆMoney –∏ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞! üí≥
